<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Covers</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="icon-512x512.png" type="image/png">
  <style>
    .container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }
    .song {
      margin: 20px 0;
    }
    h3 {
        color: #b4b5b5;
    }

    audio {
      width: 100%;
      outline: none;
      width: calc(100% - 20px);
    }
    canvas {
      width: 100%;
      height: 200px;
      border-radius: 5px;
      margin-top: 10px;
    }
    #canvas {
      position: fixed;
      left: 0;
      top: 200;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
    <button class="back-button" onclick="window.location.href='index.html'">Back</button>
  <div class="container">

    <h1>My Covers</h1>
    <h3>I did them out of boredom and for fun so they are not proper covers</h3>
    <h3>...Just another way to say they are horrible :)</h3>

    <div class="song">
        <h2>Wicked Game - Him</h2>
        <audio controls id="audio1">
            <source src="media/Wicked_game.mp3" type="audio/mpeg">
          Your browser does not support the audio element.
        </audio>
    </div>

    <div class="song">
      <h2>One more light - Linkin Park</h2>
      <audio controls id="audio2">
        <source src="media/One_more_light.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>

    <div class="song">
      <h2>Leave a light on - Papa Roach</h2>
      <audio controls id="audio3">
        <source src="media/Leave_a_light_on.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>

    <div class="song">
      <h2>I see fire - Ed Sheeran</h2>
      <audio controls id="audio4">
        <source src="media/I_see_fire.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
    </div>
      <!-- Visualizer Canvas -->
    <canvas id="canvas"></canvas>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    var audioElements = {
        audio1: document.getElementById("audio1"),
        audio2: document.getElementById("audio2"),
        audio3: document.getElementById("audio3"),
        audio4: document.getElementById("audio4")
    };

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    // Make canvas responsive to window size
    canvas.width = window.innerWidth;
    canvas.height = 200; // fixed height for the visualizer
    
    // Set up AudioContext and analyser
    var context = new (window.AudioContext || window.webkitAudioContext)();  // Ensure compatibility across browsers

    // Resume AudioContext after user gesture (e.g. play)
    var isUserInteracted = false;
    function resumeAudioContext() {
        if (!isUserInteracted) {
            isUserInteracted = true;
            if (context.state === 'suspended') {
                context.resume();
            }
        }
    }

    // Setup analyser
    var analyser = context.createAnalyser();
    analyser.fftSize = 256; // Number of frequency bins

    // Buffer for frequency data
    var bufferLength = analyser.frequencyBinCount;
    var dataArray = new Uint8Array(bufferLength);

    // Variables for the line visualizer
    var barHeight;
    var x = 0;
    var lineWidth = 2; // Width of the smooth wave line

    // Store the previous audio source to prevent reconnecting
    var previousSource = null;

    // Function to start visualizer on audio play
    function startVisualizer(audioElement) {
        // Disconnect previous source
        if (previousSource) {
            previousSource.disconnect();
        }

        var src = context.createMediaElementSource(audioElement);
        src.connect(analyser);
        analyser.connect(context.destination);

        previousSource = src;

        function renderFrame() {
            requestAnimationFrame(renderFrame);

            x = 0;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            analyser.getByteFrequencyData(dataArray);

            // Draw a smooth rounded waveform line
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2); // Start in the middle of the canvas

            // Loop through frequency data and create a smooth wave
            for (var i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i];

                // Apply a smooth sine wave effect using the frequency data
                var y = canvas.height / 2 + Math.sin(i / bufferLength * Math.PI * 2) * (barHeight / 2);

                // Smooth curve with rounded look
                ctx.lineTo(x, y);

                x += (canvas.width / bufferLength);
            }

            // Finish drawing the path with a rounded end
            ctx.lineWidth = lineWidth;
            ctx.strokeStyle = "rgb(0, 204, 255)"; // Smooth light cyan color
            ctx.lineJoin = 'round'; // Rounded corners on the line
            ctx.lineCap = 'round'; // Rounded end points
            ctx.stroke();
        }

        audioElement.play();
        renderFrame();
    }

    // Attach event listeners to play the audio and start the visualizer
    for (var key in audioElements) {
        audioElements[key].addEventListener("play", function() {
            // Pause all other audio elements when one starts
            for (var otherKey in audioElements) {
                if (audioElements[otherKey] !== this) {
                    audioElements[otherKey].pause();
                }
            }
            resumeAudioContext();  // Ensure AudioContext is resumed after user interaction
            startVisualizer(this);
        });
    }
});

 </script>
</body>
</html>